"use client";

import { usePreloaderContext } from "@/context/preloader-context";
import { useGSAP } from "@gsap/react";
import gsap from "gsap";
import { SplitText } from "gsap/SplitText";
import { useEffect, useRef } from "react";
import pre1 from "@/assets/images/preloaders/pre-1.jpg";
import pre2 from "@/assets/images/preloaders/pre-2.jpg";
import pre3 from "@/assets/images/preloaders/pre-3.jpg";
import pre4 from "@/assets/images/preloaders/pre-4.jpg";
import Image from "next/image";
import { twMerge } from "tailwind-merge";

gsap.registerPlugin(useGSAP, SplitText);

const preloaderImgs = [pre1, pre2, pre3, pre4];

export const Preloader = () => {
  const containerRef = useRef(null);
  const { play } = usePreloaderContext();

  useGSAP(
    () => {
      const tl = gsap.timeline({
        delay: 0.5,
        onComplete: () => {
          document.body.style.overflow = "visible";
          document.body.removeAttribute("data-lenis-prevent");
        },
      });

      tl.to(".prel-wrapper", {
        clipPath: "inset(0% 0% 0% 0%)",
        ease: "power2",
      })
        .fromTo(
          ".prel-4",
          {
            clipPath: "inset(0% 0% 0% 0%)",
          },
          { clipPath: "inset(100% 0% 0% 0%)", ease: "power2", duration: 0.8 }
        )
        .fromTo(
          ".prel-3",
          {
            clipPath: "inset(0% 0% 0% 0%)",
          },
          { clipPath: "inset(0% 100% 0% 0%)", ease: "power2", duration: 0.8 }
        )
        .fromTo(
          ".prel-2",
          {
            clipPath: "inset(0% 0% 0% 0%)",
          },
          { clipPath: "inset(0% 0% 100% 0%)", ease: "power2", duration: 0.8 }
        )
        .fromTo(
          ".prel-1",
          {
            clipPath: "inset(0% 0% 0% 0%)",
          },
          { clipPath: "inset(0% 0% 0% 100%)", ease: "power2", duration: 0.8 }
        )
        .fromTo(
          containerRef.current,
          {
            clipPath: "inset(0% 0% 0% 0%)",
          },
          {
            clipPath: "inset(100% 0% 0% 0%)",
            ease: "expo",
            duration: 0.8,
          },
          "<0.6"
        )

        .add(() => play(), "<0.5")
        .set(containerRef.current, { autoAlpha: 0, height: 0, width: 0 });
    },
    { scope: containerRef, dependencies: [play] }
  );

  useEffect(() => {
    setTimeout(() => {
      document.body.setAttribute("data-lenis-prevent", "true");
      document.body.style.overflow = "hidden";
    }, 0);
  }, []);

  return (
    <div
      ref={containerRef}
      className="fixed z-50 inset-0 bg-offblack flex justify-center items-center"
    >
      <div className="relative w-full">
        <div
          className="w-[300px] h-[200px] lg:w-[600px] lg:h-[400px] relative prel-wrapper mx-auto"
          style={{
            clipPath: "inset(100% 0% 0% 0%)",
          }}
        >
          {preloaderImgs.map((preloaderImg, idx) => (
            <div
              key={preloaderImg.src}
              className={twMerge("absolute inset-0", `prel-${idx + 1}`)}
            >
              <Image
                src={preloaderImg}
                alt=""
                className="size-full object-cover"
                priority
              />
            </div>
          ))}
        </div>
        {/* <div className="overflow-clip w-full absolute top-1/2 left-1/2 -translate-1/2">
          <h1 className="font-neue text-3xl font-semibold text-white  w-full text-center invisible">
            <span>Flaskcon</span>
            <span className="inline-block">
              {" "}
              <Logo />{" "}
            </span>
            <span>Africa</span>
          </h1>
        </div> */}
      </div>
    </div>
  );
};

const Logo = () => {
  return (
    <svg
      className="w-10 h-8 inline-block"
      width="200"
      height="153"
      viewBox="0 0 200 153"
      fill="none"
      xmlns="http://www.w3.org/2000/svg"
    >
      <g clipPath="url(#clip0_4121_2)">
        <path
          d="M48.5669 15.6083C49.782 15.1092 51.1123 16.045 50.9972 17.3301L49.5774 33.6244L46.5587 68.5214C46.5076 69.1452 46.111 69.6942 45.5226 69.9437L23.6245 79.4259C22.793 79.7877 21.8209 79.4758 21.386 78.7022C17.1011 71.0915 13.8777 60.9855 11.8567 52.8259L11.3451 53.0255C9.63111 53.7491 7.95549 53.4372 7.21362 52.3143L7.13687 52.1771L0.306481 40.0499C-0.153995 39.2015 -0.0900402 38.0162 0.523927 36.8933C1.1379 35.7954 2.30188 34.7473 3.50423 34.2358L48.5669 15.6083Z"
          fill="black"
        />
        <path
          d="M48.5669 15.6083C49.782 15.1092 51.1123 16.045 50.9972 17.3301L49.5774 33.6244L46.5587 68.5214C46.5076 69.1452 46.111 69.6942 45.5226 69.9437L23.6245 79.4259C22.793 79.7877 21.8209 79.4758 21.386 78.7022C17.1011 71.0915 13.8777 60.9855 11.8567 52.8259L11.3451 53.0255C9.63111 53.7491 7.95549 53.4372 7.21362 52.3143L7.13687 52.1771L0.306481 40.0499C-0.153995 39.2015 -0.0900402 38.0162 0.523927 36.8933C1.1379 35.7954 2.30188 34.7473 3.50423 34.2358L48.5669 15.6083Z"
          fill="url(#paint0_linear_4121_2)"
        />
        <path
          d="M92.3118 49.7192L72.8695 58.1409C71.9229 58.5526 70.8101 58.0785 70.4903 57.1178L62.0483 32.2021L55.9726 14.2733C55.6912 13.4249 56.1133 12.5016 56.9575 12.1523L85.4046 0.374397C86.607 -0.137141 87.8733 -0.124665 88.7175 0.411827C89.6129 0.898413 89.7792 1.44738 89.8047 3.04438H89.7792C89.6513 14.0861 92.2222 38.1035 93.3479 47.9725C93.4374 48.7211 93.0153 49.4197 92.3118 49.7192Z"
          fill="black"
        />
        <path
          d="M92.3118 49.7192L72.8695 58.1409C71.9229 58.5526 70.8101 58.0785 70.4903 57.1178L62.0483 32.2021L55.9726 14.2733C55.6912 13.4249 56.1133 12.5016 56.9575 12.1523L85.4046 0.374397C86.607 -0.137141 87.8733 -0.124665 88.7175 0.411827C89.6129 0.898413 89.7792 1.44738 89.8047 3.04438H89.7792C89.6513 14.0861 92.2222 38.1035 93.3479 47.9725C93.4374 48.7211 93.0153 49.4197 92.3118 49.7192Z"
          fill="url(#paint1_linear_4121_2)"
        />
        <path
          d="M100.997 82.7945C97.4286 84.5537 93.8472 86.3129 90.2785 88.0721C89.0761 88.6585 87.6691 87.7727 87.7331 86.4627L88.6796 65.2775L88.7691 63.3186C88.7947 62.6699 89.204 62.0959 89.8052 61.8339L93.5913 60.1995C94.5762 59.7753 95.7274 60.3118 95.9961 61.3224C99.3473 73.4621 100.729 77.7291 101.842 80.6611C102.149 81.4845 101.79 82.3953 100.985 82.7945H100.997Z"
          fill="black"
        />
        <path
          d="M100.997 82.7945C97.4286 84.5537 93.8472 86.3129 90.2785 88.0721C89.0761 88.6585 87.6691 87.7727 87.7331 86.4627L88.6796 65.2775L88.7691 63.3186C88.7947 62.6699 89.204 62.0959 89.8052 61.8339L93.5913 60.1995C94.5762 59.7753 95.7274 60.3118 95.9961 61.3224C99.3473 73.4621 100.729 77.7291 101.842 80.6611C102.149 81.4845 101.79 82.3953 100.985 82.7945H100.997Z"
          fill="url(#paint2_linear_4121_2)"
        />
        <path
          d="M75.7862 137.454C76.3618 138.964 74.6478 140.361 73.228 139.525C64.6708 134.51 57.2009 128.409 50.6903 121.809C50.6647 121.784 50.6263 121.759 50.6007 121.734L50.3449 121.472C49.9868 121.122 49.5903 120.686 49.1554 120.224C49.0275 120.087 48.8995 119.937 48.7588 119.787C45.8425 116.606 41.8901 111.89 41.8901 111.89C36.262 104.878 31.5678 97.6166 27.7049 90.7171C27.206 89.8437 27.6025 88.7458 28.5491 88.3341L42.7855 82.1706C44.0006 81.6466 45.3564 82.5824 45.2541 83.8799L44.2564 95.4207L43.5913 103.056C43.4762 104.354 44.832 105.302 46.0599 104.766L53.2357 101.647L59.2986 99.0015C60.2324 98.6023 61.3196 99.0389 61.665 99.9747L62.3557 101.821L65.9499 111.341L73.4455 131.204L75.799 137.454H75.7862Z"
          fill="black"
        />
        <path
          d="M75.7862 137.454C76.3618 138.964 74.6478 140.361 73.228 139.525C64.6708 134.51 57.2009 128.409 50.6903 121.809C50.6647 121.784 50.6263 121.759 50.6007 121.734L50.3449 121.472C49.9868 121.122 49.5903 120.686 49.1554 120.224C49.0275 120.087 48.8995 119.937 48.7588 119.787C45.8425 116.606 41.8901 111.89 41.8901 111.89C36.262 104.878 31.5678 97.6166 27.7049 90.7171C27.206 89.8437 27.6025 88.7458 28.5491 88.3341L42.7855 82.1706C44.0006 81.6466 45.3564 82.5824 45.2541 83.8799L44.2564 95.4207L43.5913 103.056C43.4762 104.354 44.832 105.302 46.0599 104.766L53.2357 101.647L59.2986 99.0015C60.2324 98.6023 61.3196 99.0389 61.665 99.9747L62.3557 101.821L65.9499 111.341L73.4455 131.204L75.799 137.454H75.7862Z"
          fill="url(#paint3_linear_4121_2)"
        />
        <path
          d="M49.1686 120.224C49.0279 120.087 48.8872 119.937 48.7593 119.8H48.7721C48.9128 119.937 49.0407 120.087 49.1686 120.224Z"
          fill="black"
        />
        <path
          d="M197.799 135.758L191.237 138.228C190.572 138.477 190.061 139.064 190.048 139.75C190.022 140.598 189.575 141.522 188.104 142.058L181.977 144.379C180.058 145.115 178.664 143.93 178.472 142.782L178.28 141.784C141.391 156.132 112.112 155.358 89.1397 146.999C88.1548 146.637 87.1955 146.275 86.2362 145.888C85.5583 145.614 85.1362 144.94 85.1617 144.229L85.8269 129.332L87.0548 101.921C87.0804 101.297 87.4513 100.748 88.0141 100.461L105.103 92.0397C105.96 91.6155 106.996 91.9523 107.444 92.7758C113.289 103.506 120.209 111.291 127.551 116.868C143.988 129.307 162.189 130.542 173.854 129.632C174.916 129.544 175.645 128.583 175.428 127.56C175.287 126.862 175.568 126.338 176.489 126.151C178.485 125.751 180.301 124.803 182.143 123.992C182.949 123.63 183.793 123.705 184.484 124.104C184.944 124.379 185.494 124.479 186.006 124.292L191.365 122.283C192.363 121.896 193.489 122.208 194.205 122.982L199.053 130.143C201.419 133.374 198.669 135.421 197.786 135.745L197.799 135.758Z"
          fill="black"
        />
        <path
          d="M197.799 135.758L191.237 138.228C190.572 138.477 190.061 139.064 190.048 139.75C190.022 140.598 189.575 141.522 188.104 142.058L181.977 144.379C180.058 145.115 178.664 143.93 178.472 142.782L178.28 141.784C141.391 156.132 112.112 155.358 89.1397 146.999C88.1548 146.637 87.1955 146.275 86.2362 145.888C85.5583 145.614 85.1362 144.94 85.1617 144.229L85.8269 129.332L87.0548 101.921C87.0804 101.297 87.4513 100.748 88.0141 100.461L105.103 92.0397C105.96 91.6155 106.996 91.9523 107.444 92.7758C113.289 103.506 120.209 111.291 127.551 116.868C143.988 129.307 162.189 130.542 173.854 129.632C174.916 129.544 175.645 128.583 175.428 127.56C175.287 126.862 175.568 126.338 176.489 126.151C178.485 125.751 180.301 124.803 182.143 123.992C182.949 123.63 183.793 123.705 184.484 124.104C184.944 124.379 185.494 124.479 186.006 124.292L191.365 122.283C192.363 121.896 193.489 122.208 194.205 122.982L199.053 130.143C201.419 133.374 198.669 135.421 197.786 135.745L197.799 135.758Z"
          fill="url(#paint4_linear_4121_2)"
        />
        <path
          d="M78.5114 66.6623C80.2509 65.9013 82.1952 67.1988 82.1056 69.0454L81.044 92.6136L80.5323 104.142L79.8161 120.237C79.7265 122.171 76.9765 122.582 76.2985 120.773L71.6682 108.509L68.0867 98.9891L65.2983 91.6155C64.9401 90.6548 63.8145 90.1931 62.8552 90.6049L53.4027 94.7221C52.1363 95.2711 50.7293 94.2979 50.8572 92.9505L52.1491 78.1158L53.134 66.6499L55.2062 42.7822C55.3725 40.8608 58.1225 40.5489 58.7365 42.3705L65.1959 61.4347L67.8309 69.1826C68.1635 70.1807 69.3146 70.6673 70.2996 70.2431L78.5114 66.6623Z"
          fill="url(#paint5_linear_4121_2)"
        />
        <path
          d="M78.5114 66.6623C80.2509 65.9013 82.1952 67.1988 82.1056 69.0454L81.044 92.6136L80.5323 104.142L79.8161 120.237C79.7265 122.171 76.9765 122.582 76.2985 120.773L71.6682 108.509L68.0867 98.9891L65.2983 91.6155C64.9401 90.6548 63.8145 90.1931 62.8552 90.6049L53.4027 94.7221C52.1363 95.2711 50.7293 94.2979 50.8572 92.9505L52.1491 78.1158L53.134 66.6499L55.2062 42.7822C55.3725 40.8608 58.1225 40.5489 58.7365 42.3705L65.1959 61.4347L67.8309 69.1826C68.1635 70.1807 69.3146 70.6673 70.2996 70.2431L78.5114 66.6623Z"
          fill="url(#paint6_linear_4121_2)"
        />
        <path
          d="M78.5108 66.6623C80.2503 65.9013 82.1946 67.1988 82.105 69.0454L81.0434 92.6136L80.5317 104.142L80.455 105.851C80.3527 108.035 77.0782 108.147 76.8351 105.963L75.6456 95.2711L74.0851 81.3472C73.9572 80.1495 72.6653 79.4258 71.5397 79.9249L64.2488 83.1064C63.136 83.593 61.8441 82.8819 61.7034 81.6966L60.8208 74.3853L59.5545 63.8925L58.058 51.5657C57.8021 49.4447 60.8976 48.771 61.5883 50.8046L65.1953 61.4471L67.8303 69.1951C68.1628 70.1932 69.314 70.6798 70.2989 70.2556L78.5108 66.6748V66.6623Z"
          fill="url(#paint7_linear_4121_2)"
        />
        <path
          d="M78.5108 66.6623C80.2503 65.9013 82.1946 67.1988 82.105 69.0454L81.0434 92.6136L80.5317 104.142L80.455 105.851C80.3527 108.035 77.0782 108.147 76.8351 105.963L75.6456 95.2711L74.0851 81.3472C73.9572 80.1495 72.6653 79.4258 71.5397 79.9249L64.2488 83.1064C63.136 83.593 61.8441 82.8819 61.7034 81.6966L60.8208 74.3853L59.5545 63.8925L58.058 51.5657C57.8021 49.4447 60.8976 48.771 61.5883 50.8046L65.1953 61.4471L67.8303 69.1951C68.1628 70.1932 69.314 70.6798 70.2989 70.2556L78.5108 66.6748V66.6623Z"
          fill="url(#paint8_linear_4121_2)"
        />
      </g>
      <defs>
        <linearGradient
          id="paint0_linear_4121_2"
          x1="46.1566"
          y1="68.6127"
          x2="4.20933"
          y2="36.3181"
          gradientUnits="userSpaceOnUse"
        >
          <stop stopColor="#EC0868" />
          <stop offset="0.466346" stopColor="#C200FB" />
          <stop offset="1" stopColor="#534EFF" />
        </linearGradient>
        <linearGradient
          id="paint1_linear_4121_2"
          x1="74.6273"
          y1="55.856"
          x2="88.6991"
          y2="-2.62829"
          gradientUnits="userSpaceOnUse"
        >
          <stop stopColor="#EC0868" />
          <stop offset="0.466346" stopColor="#C200FB" />
          <stop offset="1" stopColor="#534EFF" />
        </linearGradient>
        <linearGradient
          id="paint2_linear_4121_2"
          x1="87.7681"
          y1="79.5183"
          x2="101.926"
          y2="75.4188"
          gradientUnits="userSpaceOnUse"
        >
          <stop stopColor="#EC0868" />
          <stop offset="0.466346" stopColor="#C200FB" />
          <stop offset="1" stopColor="#534EFF" />
        </linearGradient>
        <linearGradient
          id="paint3_linear_4121_2"
          x1="59.1731"
          y1="104.201"
          x2="45.2543"
          y2="118.493"
          gradientUnits="userSpaceOnUse"
        >
          <stop stopColor="#EC0868" />
          <stop offset="0.466346" stopColor="#C200FB" />
          <stop offset="1" stopColor="#534EFF" />
        </linearGradient>
        <linearGradient
          id="paint4_linear_4121_2"
          x1="142.576"
          y1="91.8559"
          x2="142.576"
          y2="152.989"
          gradientUnits="userSpaceOnUse"
        >
          <stop stopColor="#EC0868" />
          <stop offset="0.466346" stopColor="#C200FB" />
          <stop offset="1" stopColor="#534EFF" />
        </linearGradient>
        <linearGradient
          id="paint5_linear_4121_2"
          x1="66.4878"
          y1="121.933"
          x2="66.4878"
          y2="41.1602"
          gradientUnits="userSpaceOnUse"
        >
          <stop stopColor="#FBB03B" />
          <stop offset="1" stopColor="#FFF500" />
        </linearGradient>
        <linearGradient
          id="paint6_linear_4121_2"
          x1="53.4516"
          y1="49.8313"
          x2="72.1547"
          y2="122"
          gradientUnits="userSpaceOnUse"
        >
          <stop stopColor="#FFBC0A" />
          <stop offset="0.173077" stopColor="#EC7D10" />
          <stop offset="0.332086" stopColor="#FC2F00" />
          <stop offset="0.539557" stopColor="#EC0868" />
          <stop offset="0.727192" stopColor="#C200FB" />
          <stop offset="1" stopColor="#534EFF" />
        </linearGradient>
        <linearGradient
          id="paint7_linear_4121_2"
          x1="58.058"
          y1="78.565"
          x2="82.1178"
          y2="78.565"
          gradientUnits="userSpaceOnUse"
        >
          <stop stopColor="#FBB03B" />
          <stop offset="1" stopColor="#FFF500" />
        </linearGradient>
        <linearGradient
          id="paint8_linear_4121_2"
          x1="60.0465"
          y1="55.8046"
          x2="72.6623"
          y2="108.026"
          gradientUnits="userSpaceOnUse"
        >
          <stop stopColor="#534EFF" />
          <stop offset="0.272808" stopColor="#C200FB" />
          <stop offset="0.460443" stopColor="#EC0868" />
          <stop offset="0.667914" stopColor="#FC2F00" />
          <stop offset="0.826923" stopColor="#EC7D10" />
          <stop offset="1" stopColor="#FFBC0A" />
        </linearGradient>
        <clipPath id="clip0_4121_2">
          <rect width="200" height="153" fill="white" />
        </clipPath>
      </defs>
    </svg>
  );
};
